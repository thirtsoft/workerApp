<div class="page-wrapper">
    <div class="content container-fluid">
        <div class="page-header">
            <div class="row">
                <div class="col-sm-7">
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a [routerLink]="'/admin/'">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="javascript:(0);">List des Ouvriers</a></li>
                        <li class="breadcrumb-item active">Gestion des Ouvriers</li>
                    </ul>
                </div>
                <div class="col-sm-5 col">
                    <a class="btn btn-primary float-right mt-2" data-toggle="modal" (click)="openModal(template)">
                         Ajouter
                    </a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <div class="table-responsive">
                                <table class="datatable table table-hover table-center mb-0">
                                    <thead>
                                        <tr>
                                            <th>Nom et Prénom</th>
                                            <th>Address</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Disponibilité</th>
                                            <th>CV</th>
                                            <th>Selected</th>
                                            <th class="text-right">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let ouvrier of ouvriersList">
                                            <td>
                                                <h2 class="table-avatar">
                                                    <a [routerLink]="'/admin/doc-profile'" class="avatar avatar-sm mr-3">
                                                        <!-- <img class="avatar-img rounded-circle" [src]="ouvrier.img" alt="User Image"></a> -->
                                                        <img class="avatar-img rounded-circle" alt="User Image" src="{{
															this.ouvService.apiServerUrl +
															'/ouvriers/photoOuvrierInFolder/' +
															ouvrier.id
															}}">
                                                        <a [routerLink]="'/admin/doc-profile'">{{ouvrier.firstName}}-{{ouvrier.lastName}} </a>
                                                    </a>
                                                </h2>
                                            </td>
                                            <td>{{ouvrier?.locality?.name}}</td>
                                            <td>{{ouvrier.email}}</td>
                                            <td>{{ouvrier.phoneOuvrier}}</td>
                                            <td>{{ouvrier.disponibity}}</td>
                                            <td>{{ouvrier.cvOuvrier}} &nbsp;
                                                <a href="{{this.ouvService.apiServerUrl + '/ouvriers/downloadCvFileOfOuvrier/' + ouvrier.cvOuvrier}}" class="cv">
                                                    <em class="fa fa-download" style="cursor: pointer; align-items: flex-end"></em
                                                        >

                                                </a>
                                               <!--  <a href="http://localhost:8081/sen-ouvrier/v1/ouvriers/downloadCvFileOfOuvrier/{{
                                                    ouvrier.cvOuvrier
                                                  }}" class="cv">
                                                    <em class="fa fa-download" style="cursor: pointer; align-items: flex-end"></em
                                                  >&nbsp;&nbsp;
                                                </a> -->
                                            </td>
                                            <td>{{ouvrier.selected}}</td>
                                            <!-- <td>{{ouvrier.lastvisit | date : 'dd MMM yyyy'}}</td>
                                            <td class="text-right">${{ouvrier.paid}}</td> -->
                                            <td class="text-right">
                                                <div class="actions">
                                                    <a class="btn btn-sm bg-success-light" data-toggle="modal" (click)="viewOuvrierModal(viewtemplate, ouvrier)" style="cursor: pointer;">
                                                        <i class="fa fa-eye"></i> Voir
                                                    </a>
                                                    <a class="btn btn-sm bg-success-light" data-toggle="modal" (click)="editOuvrierModal(edittemplate,ouvrier)" style="cursor: pointer;">
                                                        <i class="fe fe-pencil"></i> Edit
                                                    </a>

                                                    <a data-toggle="modal" (click)="deleteOuvrierModal(delete,ouvrier)" class="btn btn-sm bg-danger-light">
                                                        <i class="fe fe-trash"></i> Delete
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<ng-template #template>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Ajouter Ouvrier</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="modalRef.hide()">
		<span aria-hidden="true">&times;</span>
	  </button>
    </div>
    <div class="modal-body">
        <form>
            <div class="row form-row">
                <div class="col-12 col-sm-12">
                    <div class="form-group">
                        <label>Reference</label>
                        <input type="text" class="form-control" name="reference" [(ngModel)]="formDataOuvrier.reference" #reference="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Prénom</label>
                        <input type="text" class="form-control" name="firstName" [(ngModel)]="formDataOuvrier.firstName" #firstName="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Nom</label>
                        <input type="text" class="form-control" name="lastName" [(ngModel)]="formDataOuvrier.lastName" #lastName="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Sexe</label>
                        <input type="text" class="form-control" name="sexe" [(ngModel)]="formDataOuvrier.sexe" #sexe="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Address Actuel</label>
                        <input type="text" class="form-control" name="addressActuel" [(ngModel)]="formDataOuvrier.addressActuel" #addressActuel="ngModel" />
                    </div>
                </div>
           
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Address</label>
                        <select name="locality" [(ngModel)]="formDataOuvrier.locality" #locality="ngModel" class="form-control" required="">
                            <option
							  *ngFor="let loc of localityList"
							  [ngValue]="
                              loc.id == formDataOuvrier.locality?.id
								  ? formDataOuvrier.locality
								  : loc
							  "
							>
							  {{ loc.name }}
							</option>
						</select>
                    </div>
                </div>

                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="text" class="form-control" name="email" [(ngModel)]="formDataOuvrier.email" #email="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Mobile</label>
                        <input type="text" class="form-control" name="phoneOuvrier" [(ngModel)]="formDataOuvrier.phoneOuvrier" #phoneOuvrier="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Profession</label>
                        <select name="metier" [(ngModel)]="formDataOuvrier.metier" #metier="ngModel" class="form-control" required="">
                            <option
							  *ngFor="let add of metiersList"
							  [ngValue]="
								add.id == formDataOuvrier.metier?.id
								  ? formDataOuvrier.metier
								  : add
							  "
							>
							  {{ add.designation }}
							</option>
						  </select>
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Nombre Années Expérience</label>
                        <input type="text" class="form-control" name="nbreAnneeExperience" [(ngModel)]="formDataOuvrier.nbreAnneeExperience" #nbreAnneeExperience="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Salaire</label>
                        <input type="number" class="form-control" name="pretentionSalaire" [(ngModel)]="formDataOuvrier.pretentionSalaire" #pretentionSalaire="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Education</label>
                        <input type="text" class="form-control" name="education" [(ngModel)]="formDataOuvrier.education" #education="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Disponibilité</label>
                        <input type="text" class="form-control" name="disponibity" [(ngModel)]="formDataOuvrier.disponibity" #disponibity="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Mobilité</label>
                        <input type="text" class="form-control" name="mobilite" [(ngModel)]="formDataOuvrier.mobilite" #mobilite="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-2">
                    <div class="form-group">
                        <label>Selected</label>
                        <input type="checkbox" class="form-control" name="selected" [(ngModel)]="formDataOuvrier.selected" #selected="ngModel" />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Photo</label>
                        <input type="file" class="form-control" name="photoOuvrier" id="photoOuvrier" (change)="selectPhotoFile($event)" required/>
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>CV</label>
                        <input type="file" class="form-control" name="cvOuvrier" id="cvOuvrier" (change)="selectCvFile($event)" required />
                    </div>
                </div>
                <div class="col-12 col-sm-12">
                    <div class="form-group">
                        <label>Description</label>
                        <textarea class="form-control" name="description" [(ngModel)]="formDataOuvrier.description" #description="ngModel" id="description" cols="7" rows="7"></textarea>
                    </div>
                </div>

            </div>
            <button type="submit" class="btn btn-primary btn-block" (click)="onSaveOuvrierWithFiles()">
		  Save Changes
		</button>
        </form>
    </div>
</ng-template>

<ng-template #edittemplate>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Modifier Ouvrier</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="modalRef.hide()">
		<span aria-hidden="true">&times;</span>
	  </button>
    </div>
    <div class="modal-body">
        <form [formGroup]="editForm" novalidate>
            <div class="row form-row">
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>ID</label>
                        <input type="text" class="form-control" formControlName="id" readonly />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Photo</label>
                        <img height="100" width="100" class="img-circle" src="{{
                            this.ouvService.apiServerUrl +
                              '/ouvriers/photoOuvrierInFolder/' +
                              editForm.value.id
                          }}" />
                        <span *ngIf="!editPhoto">
                          <input type="file" (change)="onSelectPhotoFile($event)" />
                          <button
                            class="btn btn-success btn-sm"
                            (click)="processForm()"
                          >
                            <span class="glyphicon glyphicon-upload"></span> Enregistrer la photo
                        </button>
                        {{ progress }}
                        </span>
                    </div>
                </div>
            </div>

            <div class="row form-row">
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Reference</label>
                        <input type="text" class="form-control" formControlName="reference" readonly />
                    </div>
                </div>

                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>CV</label>
                        <input type="text" class="form-control" formControlName="cvOuvrier" readonly />
                        <span *ngIf="!editCv">
                            <input type="file" (change)="onSelectCvFile($event)" />
                            <button
                              class="btn btn-success btn-sm"
                              (click)="processCvForm()"
                            >
                              <span class="glyphicon glyphicon-upload"></span> Enregistrer le cv
                          </button>
                          {{ progress }}
                          </span>
                    </div>
                </div>
            </div>

            <div class="row form-row">
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Prénom</label>
                        <input type="text" name="firstName" class="form-control" formControlName="firstName" />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Nom</label>
                        <input type="text" name="lastName" class="form-control" formControlName="lastName" />
                    </div>
                </div>
            </div>

            <div class="row form-row">
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Sexe</label>
                        <input type="text" name="sexe" class="form-control" formControlName="sexe" />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Addresse</label> 
                          <select [compareWith]="compareLocality" formControlName="locality" class="form-control ">
                            <option
                                *ngFor="let loc of localityList"
                                [ngValue]="loc"
                            >
                                {{ loc.name }}
                            </option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="row form-row">
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email" class="form-control" formControlName="email" />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Mobile</label>
                        <input type="text" name="phoneOuvrier" class="form-control" formControlName="phoneOuvrier" />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Profession</label>
                          <select [compareWith]="compareMetier" formControlName="metier" class="form-control ">
                            <option
                                *ngFor="let met of metiersList "
                                [ngValue]="met"
                            >
                                {{ met.designation }}
                            </option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row form-row">
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Education</label>
                        <input type="text" name="education" class="form-control" formControlName="education" />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Nombre Années Expérience</label>
                        <input type="text" name="nbreAnneeExperience" class="form-control" formControlName="nbreAnneeExperience" />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Prétention salaire</label>
                        <input type="number" name="pretentionSalaire" class="form-control" formControlName="pretentionSalaire" />
                    </div>
                </div>
            </div>

            <div class="row form-row">
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Disponibilité</label>
                        <input type="text" name="disponibity" class="form-control" formControlName="disponibity" />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Mobilité</label>
                        <input type="text" name="mobilite" class="form-control" formControlName="mobilite" />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Selected</label>
                        <input type="checkbox" name="selected" formControlName="selected" class="form-control" />
                    </div>
                </div>
            </div>

            <div class="row form-row">
                <div class="col-12 col-sm-12">
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="description" cols="2" rows="2" type="text" class="form-control" name="description" formControlName="description"></textarea>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-warning btn-block" (click)="updateOuvrier()">
		  Modifier
		</button>

            <button type="submit" class="btn btn-primary btn-block" (click)="modalRef.hide()">
            Fermer
          </button>
        </form>
    </div>
</ng-template>

<ng-template #viewtemplate>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Détail Ouvrier</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="modalRef.hide()">
		<span aria-hidden="true">&times;</span>
	  </button>
    </div>
    <div class="modal-body">
        <form [formGroup]="viewForm" novalidate>
            <div class="row form-row">
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>ID</label>
                        <input type="text" class="form-control" formControlName="id" readonly />
                    </div>
                </div>
                <div class="col-12 col-sm-6">
                    <label for="">Photo</label>
                    <img height="100" width="100" class="img-circle" src="{{
                        this.ouvService.apiServerUrl +
                          '/ouvriers/photoOuvrierInFolder/' +
                          viewForm.value.id
                      }}" />
                </div>
            </div>
            <div class="row form-row">
                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Prénom</label>
                        <input type="text" class="form-control" formControlName="firstName" readonly />
                    </div>
                </div>

                <div class="col-12 col-sm-6">
                    <div class="form-group">
                        <label>Nom</label>
                        <input type="text" class="form-control" formControlName="lastName" readonly />
                    </div>
                </div>
            </div>

            <div class="row form-row">
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Reference</label>
                        <input type="text" class="form-control" formControlName="reference" readonly />
                    </div>
                </div>
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Sexe</label>
                        <input type="text" class="form-control" formControlName="sexe" readonly />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Addresse</label> 
                        <select formControlName="locality" name="locality" [compareWith]="compareLocality"  class="form-control" readonly>
                            <option
                                *ngFor="let loc of localityList "
                                [ngValue]="loc"
                                readonly
                            >
                            {{ loc.name }}
                            </option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="row form-row">
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="text" class="form-control" formControlName="email" readonly />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Mobile</label>
                        <input type="text" class="form-control" formControlName="phoneOuvrier" readonly />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Profession</label>
                        <select [compareWith]="compareMetier" formControlName="metier" class="form-control" readonly>
                            <option
                                *ngFor="let met of metiersList "
                                [ngValue]="met"
                                readonly
                            >
                                {{ met.designation }}
                            </option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="row form-row">

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Education</label>
                        <input type="text" class="form-control" formControlName="education" readonly />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Nombre Années Expérience</label>
                        <input type="text" class="form-control" formControlName="nbreAnneeExperience" readonly />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>CV</label>
                        <input type="text" class="form-control" formControlName="cvOuvrier" readonly />
                    </div>
                </div>

            </div>

            <div class="row form-row">
                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Prétention salaire</label>
                        <input type="text" class="form-control" formControlName="pretentionSalaire" readonly />
                    </div>
                </div>
                <div class="col-12 col-sm-3">
                    <div class="form-group">
                        <label>Disponibilité</label>
                        <input type="text" class="form-control" formControlName="disponibity" readonly />
                    </div>
                </div>

                <div class="col-12 col-sm-4">
                    <div class="form-group">
                        <label>Mobilité</label>
                        <input type="text" class="form-control" formControlName="mobilite" readonly />
                    </div>
                </div>

                <div class="col-12 col-sm-1">
                    <div class="form-group">
                        <label>Selected</label>
                        <input type="checkbox" class="form-control" formControlName="selected" readonly />
                    </div>
                </div>

            </div>

            <div class="row form-row">
                <div class="col-12 col-sm-12">
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="description" cols="2" rows="2" type="text" class="form-control" formControlName="description" readonly></textarea>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-block" (click)="modalRef.hide()">
		  Fermer
		</button>
        </form>
    </div>
</ng-template>


<ng-template #delete>
    <div class="modal-header">
        <h4 class="modal-title pull-left">Delete</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="modalRef.hide()">
		<span aria-hidden="true">&times;</span>
	  </button>
    </div>
    <div class="modal-body text-center">
        Etes vous sur de supprimer cet Ouvrier ??
        <div style="margin-top: 25px">
            <button type="button" class="btn btn-default" (mouseover)="btnColor()" id="btn-yes" (click)="deleteOuvrier()">
		  Yes
		</button>
            <button type="button" class="btn btn-primary" (mouseover)="btnColorNo()" id="btn-no" (click)="decline()">
		  No
		</button>
        </div>
    </div>
</ng-template>